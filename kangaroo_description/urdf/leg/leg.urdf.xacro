<?xml version="1.0"?>

<robot xmlns:xacro="http://ros.org/wiki/xacro" name="kangaroo">

  <xacro:include filename="$(find kangaroo_description)/urdf/leg/leg.transmission.xacro" />

  <xacro:property name="deg_to_rad"       value="0.01745329251994329577" />
  <xacro:property name="eps_radians"      value="0.008" /> <!-- 0.45deg -->
  <xacro:property name="eps_meters"       value="0.005" />
  <xacro:property name="leg_1_min_pos"   value="${-15.0 *deg_to_rad}" />
  <xacro:property name="leg_1_max_pos"   value="${40.0 *deg_to_rad}" />
  <xacro:property name="leg_2_min_pos"   value="${-42.5 *deg_to_rad}" />
  <xacro:property name="leg_2_max_pos"   value="${42.5 *deg_to_rad}" />
  <xacro:property name="leg_3_min_pos"   value="${-27.0 *deg_to_rad}" />
  <xacro:property name="leg_3_max_pos"   value="${27.0 *deg_to_rad}" />
  <xacro:property name="leg_4_min_pos"   value="${10.0 *deg_to_rad}" />
  <xacro:property name="leg_4_max_pos"   value="${70.0 *deg_to_rad}" />
  <xacro:property name="leg_5_min_pos"   value="${20.0 *deg_to_rad}" />
  <xacro:property name="leg_5_max_pos"   value="${140.0 *deg_to_rad}" />
  <xacro:property name="leg_6_min_pos"   value="${-42.5 *deg_to_rad}" />
  <xacro:property name="leg_6_max_pos"   value="${42.5 *deg_to_rad}" />
  <xacro:property name="leg_7_min_pos"   value="${-27.0 *deg_to_rad}" />
  <xacro:property name="leg_7_max_pos"   value="${27.0 *deg_to_rad}" />

  <xacro:macro name="kangaroo_leg" params="side reflect parent *origin">
    <link name="leg_${side}_1_link">
      <inertial>
        <origin xyz="0.0461079574284527 -0.000826631128234001 0.00897630312181676" rpy="0 0 0" />
        <mass value="2.49954419149183" />
        <inertia ixx="0.00151181747940305" ixy="${reflect * 8.83298140320242E-06}" ixz="${reflect * 2.17752660615735E-05}" iyy="0.00154876023440654" iyz="${reflect * -1.94449871986378E-05}" izz="0.00136106613590181" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_1_link.stl" scale="1 ${reflect} 1"/>
        </geometry>
        <material name="">
          <color rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_1_link.stl" scale="1 ${reflect} 1"/>
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_1_joint" type="revolute">
      <xacro:insert_block name="origin"/>
      <parent link="${parent}" />
      <child link="leg_${side}_1_link" />
      <axis xyz="0 0 1" />
      <xacro:if value="${reflect == 1}">
        <limit lower="${leg_1_min_pos}" upper="${leg_1_max_pos}" effort="100" velocity="3.87" />
      </xacro:if>
      <xacro:if value="${reflect == -1}">
        <limit lower="${reflect * leg_1_max_pos}" upper="${reflect * leg_1_min_pos}" effort="100" velocity="3.87" />
      </xacro:if>
    </joint>
    <link name="leg_${side}_2_link">
      <inertial>
        <origin xyz="-0.00299642516878475 -0.000101293190038279 6.76277450706309E-10" rpy="0 0 0" />
        <mass value="0.0907287903783648" />
        <inertia ixx="6.10402208807908E-06" ixy="${reflect * 3.54403077254796E-08}" ixz="${reflect * -3.0910293306339E-13}"
          iyy="3.90470919341026E-05" iyz="${reflect * -1.14069181428674E-12}" izz="3.64238433670963E-05" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_2_link.stl" scale="1 ${reflect} 1"/>
        </geometry>
        <material name="">
          <color rgba="0.894117647058823 0.913725490196078 0.929411764705882 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_2_link.stl" scale="1 ${reflect} 1"/>
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_2_joint" type="revolute">
      <origin xyz="0.016042 0 -0.0925" rpy="0 0 0" />
      <parent link="leg_${side}_1_link" />
      <child link="leg_${side}_2_link" />
      <axis xyz="0 1 0" />
      <limit lower="${leg_2_min_pos}" upper="${leg_2_max_pos}" effort="100" velocity="3.87" />
    </joint>
    <link name="leg_${side}_3_link">
      <inertial>
        <origin xyz="-0.042791492019428 0.0477271400490046 -0.0411219993940296" rpy="0 0 0" />
        <mass value="3.66987205802361" />
        <inertia ixx="0.00226579365890287" ixy="${reflect * 0.000186528466622377}" ixz="${reflect * -9.4464170720752E-05}"
          iyy="0.00347844100338387" iyz="${reflect * 4.48424073671215E-05}" izz="0.00335571040406776" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_3_link.stl" scale="1 ${reflect} 1"/>
        </geometry>
        <material name="">
          <color rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_3_link.stl" scale="1 ${reflect} 1"/>
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_3_joint" type="revolute">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <parent link="leg_${side}_2_link" />
      <child link="leg_${side}_3_link" />
      <axis xyz="-1 0 0" />
      <limit lower="${leg_3_min_pos}" upper="${leg_3_max_pos}" effort="100" velocity="3.87" />
    </joint>
    <link name="leg_${side}_4_link">
      <inertial>
        <origin xyz="0.114702002010089 0.000182856660852354 -0.0143986490691173" rpy="0 0 0" />
        <mass value="3.57408268817521" />
        <inertia ixx="0.00247170768644724" ixy="2.87874888621229E-05" ixz="0.00247469186737281"
          iyy="0.0126050262407564" iyz="1.01404330133204E-05" izz="0.0116319632922522" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_4_link.stl" />
        </geometry>
        <material name="">
          <color rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_4_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_4_joint" type="revolute">
      <origin xyz="0 ${reflect * 0.0669} -0.09" rpy="0 ${-10.0 * deg_to_rad} 0" />
      <parent link="leg_${side}_3_link" />
      <child link="leg_${side}_4_link" />
      <axis xyz="0 1 0" />
      <limit lower="${leg_4_min_pos}" upper="${leg_4_max_pos}" effort="100" velocity="3.87" />
    </joint>
    <link name="leg_${side}_5_link">
      <inertial>
        <origin xyz="-0.158662729273678 -8.28192764317226E-05 -0.0337468261967321" rpy="0 0 0" />
        <mass value="0.87223211672797" />
        <inertia ixx="0.000350603269949793" ixy="6.37793331536252E-07" ixz="-0.000461550351107159"
          iyy="0.00242184402988972" iyz="5.09327556678297E-07" izz="0.0022368624903808" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_5_link.stl" />
        </geometry>
        <material name="">
          <color rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_5_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_5_joint" type="revolute">
      <origin xyz="0.37413 0 -0.066509" rpy="0 ${20.0 * deg_to_rad} 0" />
      <parent link="leg_${side}_4_link" />
      <child link="leg_${side}_5_link" />
      <axis xyz="0 -1 0" />
      <limit lower="${leg_5_min_pos}" upper="${leg_5_max_pos}" effort="100" velocity="3.87" />
    </joint>
    <link name="leg_${side}_6_link">
      <inertial>
        <origin xyz="-0.00714160332877733 4.8311277200952E-09 0.00259941265068991" rpy="0 0 0" />
        <mass value="0.0905836559788966" />
        <inertia ixx="7.07461991271062E-06" ixy="-1.86951004827933E-12" ixz="8.30282143898823E-06"
          iyy="2.92762498059213E-05" iyz="1.82895645239997E-11" izz="2.68643074366886E-05" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_6_link.stl" />
        </geometry>
        <material name="">
          <color rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_6_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_6_joint" type="revolute">
      <origin xyz="-0.37432 0 -0.065464" rpy="0 0 0" />
      <parent link="leg_${side}_5_link" />
      <child link="leg_${side}_6_link" />
      <axis xyz="0 1 0" />
      <limit lower="${leg_6_min_pos}" upper="${leg_6_max_pos}" effort="100" velocity="3.87" />
    </joint>
    <link name="leg_${side}_7_link">
      <inertial>
        <origin xyz="0.0177425915954867 -3.67950153736807E-05 -0.0172694732454237" rpy="0 0 0" />
        <mass value="0.394418327358563" />
        <inertia ixx="0.000228382894016579" ixy="-2.56621760255351E-07" ixz="4.1179623691202E-05"
          iyy="0.00108653696539759" iyz="7.85648127231571E-09" izz="0.0012643765698811" />
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_7_link.stl" />
        </geometry>
        <material name="">
          <color rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://kangaroo_description/meshes/leg_7_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint name="leg_${side}_7_joint" type="revolute">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <parent link="leg_${side}_6_link" />
      <child link="leg_${side}_7_link" />
      <axis xyz="-0.93969 0 0.34202" />
      <limit lower="${leg_7_min_pos}" upper="${leg_7_max_pos}" effort="100" velocity="3.87" />
    </joint>
<!-- 

    <xacro:kangaroo_leg_length_actuator_transmission side="${side}" number1="1" number2="2" femur="0.380" intersection_crank_axis="${0.360*5.8/9.2}" fbl11_long="0.360" fbl11_short="0.095" fbl21_fixed="0.1265" fbl21_long="0.099" fbl21_short="${0.1265/2.875}" crank_slider_long="0.120" crank_slider_short="0.090" crank_slider_axis_angle="{-5.0*deg_to_rad}" shin_offset_angle="{-5.0*deg_to_rad}" connection_fbl_offset_angle="{5.0*deg_to_rad}" knee_angle_min ="{40*deg_to_rad}" knee_angle_max="{160*deg_to_rad}" />
    -->
    <xacro:kangaroo_lower_body_simple_simulation_transmission side="${side}"/>

   <gazebo reference="leg_${side}_1_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>
   <gazebo reference="leg_${side}_2_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>
   <gazebo reference="leg_${side}_3_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>
   <gazebo reference="leg_${side}_4_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>
   <gazebo reference="leg_${side}_5_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>
   <gazebo reference="leg_${side}_6_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>
   <gazebo reference="leg_${side}_7_link">
     <mu1>0.9</mu1>
     <mu2>0.9</mu2>
   </gazebo>

   <gazebo reference="leg_${side}_1_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>
   <gazebo reference="leg_${side}_2_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>
   <gazebo reference="leg_${side}_3_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>
   <gazebo reference="leg_${side}_4_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>
   <gazebo reference="leg_${side}_5_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>
   <gazebo reference="leg_${side}_6_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>
   <gazebo reference="leg_${side}_7_joint">
      <implicitSpringDamper>1</implicitSpringDamper>
   </gazebo>

  <gazebo reference="leg_${side}_1_link">
    <material>Gazebo/FlatWhite</material>
  </gazebo>
  <gazebo reference="leg_${side}_2_link">
    <material>Gazebo/FlatWhite</material>
  </gazebo>
  <gazebo reference="leg_${side}_3_link">
    <material>Gazebo/FlatWhite</material>
  </gazebo>
  <gazebo reference="leg_${side}_4_link">
    <material>Gazebo/FlatBlack</material>
  </gazebo>
  <gazebo reference="leg_${side}_5_link">
    <material>Gazebo/FlatBlack</material>
  </gazebo>
  <gazebo reference="leg_${side}_6_link">
    <material>Gazebo/FlatWhite</material>
  </gazebo>
  <gazebo reference="leg_${side}_7_link">
    <material>Gazebo/FlatWhite</material>
  </gazebo>

  </xacro:macro>

</robot>
